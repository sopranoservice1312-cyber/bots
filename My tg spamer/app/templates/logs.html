{% extends 'base.html' %}
{% block content %}
<div class='card'>
  <h2>Logs</h2>
  <table>
    <tr>
      <th>ID</th>
      <th>Account</th>
      <th>Target</th>
      <th>Template</th>
      <th>Status</th>
      <th>Error</th>
      <th>Created</th>
    </tr>
    {% for l in rows %}
    <tr>
      <td>{{l.id}}</td>
      <td>{{accounts[l.account_id].phone if l.account_id in accounts else ''}}</td>
      <td>{{l.target}}</td>
      <td>{{templates[l.template_id].title if l.template_id in templates else ''}}</td>
      <td>{{l.status}}</td>
      <td>{{l.error or ''}}</td>
      <td>{{l.created_at}}</td>
    </tr>
    {% endfor %}
  </table>
</div>
<div class='card'>
  <h2>Jobs</h2>
  <table>
    <tr>
      <th>ID</th>
      <th>Status</th>
      <th>Cyclic</th>
      <th>Paused</th>
      <th>Stopped</th>
      <th>Next run</th>
      <th>Actions</th>
    </tr>
    {% for job in jobs %}
    <tr>
      <td>{{job.id}}</td>
      <td>{{job.status}}</td>
      <td>{{'✅' if job.is_cyclic else '❌'}}</td>
      <td>{{'⏸️' if job.paused else '▶️'}}</td>
      <td>{{'⛔️' if job.stopped else ' '}}</td>
      <td>{{job.next_run_at if job.is_cyclic else ''}}</td>
      <td>
        {% if job.is_cyclic and not job.stopped %}
          <form method="post" action="/jobs/{{job.id}}/pause" style="display:inline;">
            {% if job.paused %}
              <button type="submit">Continue</button>
            {% else %}
              <button type="submit">Pause</button>
            {% endif %}
          </form>
          <form method="post" action="/jobs/{{job.id}}/stop" style="display:inline;">
            <button type="submit">Stop</button>
          </form>
        {% endif %}
        <form method="post" action="/jobs/{{job.id}}/delete" style="display:inline;">
          <button type="submit" onclick="return confirm('Удалить задачу полностью?')">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>
{% endblock %}