# Telegram Consent Messenger — Pro (Windows)

**Состав пакета**: веб-панель (FastAPI + Jinja2) с авторизацией user-аккаунтов Telegram (Telethon), шаблонами с плейсхолдерами,
импортом целей из CSV, очередью отправок, авто-ретраями на FloodWait, планировщиком (отложенная/по расписанию), ротацией аккаунтов,
логами по каждому отправлению. В комплекте — пример CSV и пример шаблонов.

## Установка (Windows)

1. Установите Python 3.11+ и (опционально) Git.
2. Скопируйте файл `.env.example` в `.env` и укажите значения:
   - `TELEGRAM_API_ID` и `TELEGRAM_API_HASH`: получите на https://my.telegram.org (API Development Tools).
   - Остальные параметры можно оставить по умолчанию.
3. В командной строке (CMD/PowerShell) в папке проекта:
   ```bat
   python -m venv .venv
   .venv\Scripts\activate
   pip install -r requirements.txt
   ```
4. Запуск панели:
   ```bat
   run.bat
   ```
   Панель будет доступна на http://127.0.0.1:8000

## Быстрый старт

1. **Accounts** → Add Account → введите телефон → **Start Login** → введите код (и пароль 2FA при необходимости) → статус станет ✅.
2. **Templates** → создайте шаблоны. Плейсхолдеры вида `{name}`, `{order_id}` и т.д.
3. **Send**:
   - Вариант А: Вставьте цели (по одной на строке: `@username`, `t.me/...`, числовой id или телефон).
   - Вариант Б: Загрузите CSV (`username`, `phone`, `chat_link`) — формат определяется автоматически. Можно использовать `examples/contacts.csv`.
   - Выберите один/несколько шаблонов, включите **Randomize**, если нужно, укажите расписание (необязательно) и отправьте.
4. **Logs** — следите за статусами `queued/scheduled/sent/failed/skipped/retried` и текстом ошибки.

## Функции

- **Плейсхолдеры**: любые ключи `{...}`. Значения берутся из CSV (колонки становятся переменными) или из формы (глобальные значения).
- **Импорт CSV**: поддерживаются колонки `username`, `phone`, `chat_link`, а также любые дополнительные — они доступны как плейсхолдеры.
- **Ротация аккаунтов**: задания отправки распределяются по авторизованным аккаунтам по кругу.
- **Очередь задач**: отправки помещаются в очередь, обработчик бережно дозирует скорость, выдерживает задержки и соблюдает лимиты.
- **Авто-ретраи**: при `FloodWait` задание откладывается на время ожидания + джиттер и повторяется ограниченное число раз.
- **Планировщик**: укажете дату/время (по системному времени сервера) — задача будет исполнена позже.
- **Логи по каждому событию**: подробный статус по каждому получателю с выбранным шаблоном и ошибкой (если была).

## Рекомендации

- Соблюдайте правила Telegram и местные законы. Используйте консервативные лимиты (`MAX_PER_MINUTE`).
- Не отправляйте нежелательные сообщения и используйте только согласованные каналы/пользователей.
- Для стабильной работы держите приложение запущенным; планировщик и очередь живут в процессе сервера.

## Примеры

- Пример CSV: `examples/contacts.csv`
- Примеры шаблонов: создайте через панель **Templates**; также смотрите комментарии в UI на странице **Send**.

Удачи! (сборка: 2025-08-14T12:17:45Z)


## Автозапуск панели (Windows)

В комплекте есть утилита для автозапуска панели при входе пользователя в систему.

**Установка автозапуска:**
1. Открой PowerShell или CMD от имени обычного пользователя (не обязательно от администратора).
2. Перейди в папку проекта (где находится `run.bat`) и запусти:
```
install_autostart.bat
```
Это создаст задачу в планировщике Windows, которая будет запускать `run.bat` при каждом входе в систему (Logon).

**Удаление автозапуска:**
В той же папке выполните:
```
uninstall_autostart.bat
```
Это удалит задачу из планировщика.

Примечания:
- Скрипт использует относительный путь к `run.bat` (используя `%~dp0` — директорию скрипта), поэтому не перемещайте `install_autostart.bat` из корня проекта.

